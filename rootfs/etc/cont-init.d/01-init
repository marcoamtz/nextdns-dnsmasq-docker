#!/command/with-contenv sh
# Initialization script - runs once at container startup

# Validate environment variables
if [ -z "${NEXTDNS_ID}" ] || [ "${NEXTDNS_ID}" = "abcdef" ]; then
    echo "Error: NEXTDNS_ID not set or using default value"
    exit 1
fi

# Create s6-log directories for each service
mkdir -p "${LOG_DIR}/nextdns" "${LOG_DIR}/dnsmasq"

# Set permissions on volume directories
chown -R dnsmasq:dnsmasq "${LOG_DIR}" /dhcp-leases
chmod 755 "${LOG_DIR}" "${LOG_DIR}/nextdns" "${LOG_DIR}/dnsmasq" /dhcp-leases

echo "Initialization complete"
